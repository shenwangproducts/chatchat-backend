# ğŸ—ï¸ Media Upload System Architecture

## System Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUTTER/DART APP                             â”‚
â”‚                                                                   â”‚
â”‚  1. User selects video                                          â”‚
â”‚  2. ApiService.uploadMediaContent()                             â”‚
â”‚     â””â”€ Shows progress: onProgress(0.0 - 1.0)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  POST /api/upload/media         â”‚
        â”‚  - file: binary data            â”‚
        â”‚  - fileType: video/photo/camera â”‚
        â”‚  - title: string                â”‚
        â”‚  - description: string          â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Backend Processing         â”‚
        â”‚                              â”‚
        â”‚  âœ“ Validate file type       â”‚
        â”‚  âœ“ Validate file size       â”‚
        â”‚  âœ“ Verify auth token        â”‚
        â”‚  âœ“ Save to disk             â”‚
        â”‚  âœ“ Create DB records        â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Response (201)              â”‚
        â”‚  {                           â”‚
        â”‚    uploadId: string,         â”‚ â† Used for tracking
        â”‚    fileUrl: string,          â”‚
        â”‚    fileSize: number          â”‚
        â”‚  }                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  GET /api/upload/progress/:id   â”‚
        â”‚  - Check: bytesUploaded/total   â”‚
        â”‚  - Return: percentComplete      â”‚ â† Update UI
        â”‚  - Return: status               â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
        (Optional) Cancel
        â”‚
        â””â”€â†’ POST /api/upload/cancel/:id
            â”œâ”€ Delete file
            â”œâ”€ Update DB
            â””â”€ Return: success
```

---

## Database Schema Relationship

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         User               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId              â”‚
â”‚ username: String           â”‚
â”‚ email: String              â”‚
â”‚ ...                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 1-to-Many
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       MediaUpload                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â†’â”‚    UploadProgress          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ uploadId: String (unique)        â”‚         â”‚ uploadId: String (unique)  â”‚
â”‚ userId: ObjectId (User ref)      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â†’â”‚ userId: ObjectId (User ref)â”‚
â”‚ fileName: String                 â”‚         â”‚ bytesUploaded: Number      â”‚
â”‚ fileType: String                 â”‚         â”‚ totalBytes: Number         â”‚
â”‚ title: String                    â”‚         â”‚ percentComplete: Number    â”‚
â”‚ description: String              â”‚         â”‚ status: String             â”‚
â”‚ fileUrl: String                  â”‚         â”‚ speed: Number              â”‚
â”‚ filePath: String                 â”‚         â”‚ remainingTime: Number      â”‚
â”‚ status: String                   â”‚         â”‚ startTime: Date            â”‚
â”‚ uploadedAt: Date                 â”‚         â”‚ lastUpdateTime: Date       â”‚
â”‚ completedAt: Date                â”‚         â”‚ completedTime: Date        â”‚
â”‚ cancelledAt: Date                â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ...                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Optional references
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â”‚           â”‚
        â†“           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Chat  â”‚  â”‚ Group â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoint Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MEDIA UPLOAD ENDPOINTS (3 total)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  1. POST /api/upload/media       â”‚ â† UPLOAD
  â”‚     Accept: multipart/form-data  â”‚
  â”‚     Return: uploadId             â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â†’ Validate input
         â”œâ”€â†’ Save file to disk
         â”œâ”€â†’ Create MediaUpload record
         â”œâ”€â†’ Create UploadProgress record
         â””â”€â†’ Return uploadId

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  2. GET /api/upload/progress/:id  â”‚ â† MONITOR
  â”‚     Return: Upload statistics     â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â†’ Verify ownership
         â”œâ”€â†’ Fetch UploadProgress record
         â”œâ”€â†’ Calculate speed & remaining time
         â””â”€â†’ Return progress data

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  3. POST /api/upload/cancel/:id    â”‚ â† CANCEL
  â”‚     Update: status to 'cancelled'  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â†’ Verify ownership
         â”œâ”€â†’ Check if cancellable
         â”œâ”€â†’ Delete file from disk
         â”œâ”€â†’ Update progress status
         â””â”€â†’ Return success

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SECURITY LAYER (All Endpoints)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ JWT Token Validation (authenticateToken)            â”‚
â”‚  âœ“ User Ownership Verification                         â”‚
â”‚  âœ“ File Type Validation (whitelist)                    â”‚
â”‚  âœ“ File Size Limits (500MB max)                        â”‚
â”‚  âœ“ Error Handling & Cleanup                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Storage Architecture

```
backend/
â”œâ”€â”€ uploads/
â”‚   â”œâ”€â”€ (Regular file uploads - 10MB limit)
â”‚   â”‚   â”œâ”€â”€ 1707824456123-123456789.pdf
â”‚   â”‚   â”œâ”€â”€ 1707824456124-987654321.docx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ media/  â† NEW: Media-specific storage
â”‚       â”œâ”€â”€ 1707824456125-111111111.mp4  â† Video
â”‚       â”œâ”€â”€ 1707824456126-222222222.jpg  â† Photo
â”‚       â”œâ”€â”€ 1707824456127-333333333.mov  â† Camera
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ server.js
â”‚   â”œâ”€â”€ MediaUpload model âœ…
â”‚   â”œâ”€â”€ UploadProgress model âœ…
â”‚   â”œâ”€â”€ mediaStorage config âœ…
â”‚   â”œâ”€â”€ 3 new endpoints âœ…
â”‚   â””â”€â”€ Existing endpoints (unchanged)
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ MEDIA_UPLOAD_API.md âœ…
    â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md âœ…
    â”œâ”€â”€ QUICK_REFERENCE.md âœ…
    â””â”€â”€ CHANGELOG.md âœ…
```

---

## Data Flow Timeline

```
USER ACTION          API CALL              DATABASE          FILE SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Select Video
    â”‚
    â”œâ”€â†’ POST /upload/media
         â”‚
         â”œâ”€â†’ Validate âœ“
         â”‚
         â”œâ”€â†’ Save File
         â”‚                    â”œâ”€â†’ Create MediaUpload
         â”‚                    â”‚   uploadId: "123-456"
         â”‚                    â”‚   status: "completed"
         â”‚                    â”‚
         â”‚                    â”œâ”€â†’ Create UploadProgress
         â”‚                    â”‚   percentComplete: 100
         â”‚                    â”‚
         â”‚              â””â”€â†’ uploads/media/video.mp4
         â”‚
         â””â”€â†’ Return uploadId
              â”‚
              â”œâ”€â†’ Show Success âœ“

2. Monitor Progress (optional)
    â”‚
    â”œâ”€â†’ GET /api/upload/progress/123-456
         â”‚
         â”œâ”€â†’ Read UploadProgress      â”€â†’ (No file I/O needed)
         â”‚   percentComplete: 100
         â”‚   status: "completed"
         â”‚
         â””â”€â†’ Return Progress Data

3. Cancel (optional - if not completed)
    â”‚
    â”œâ”€â†’ POST /api/upload/cancel/123-456
         â”‚
         â”œâ”€â†’ Verify ownership
         â”‚
         â”œâ”€â†’ Update UploadProgress    â”€â”€â”€â†’ Update status: "cancelled"
         â”‚   status: "cancelled"
         â”‚
         â”œâ”€â†’ Update MediaUpload
         â”‚   status: "cancelled"
         â”‚
         â””â”€â†’ Delete File  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Remove from uploads/media/
              Return Success âœ“
```

---

## Request/Response Cycle

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    REQUEST (Client â†’ Server)                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘  POST /api/upload/media                                         â•‘
â•‘  Content-Type: multipart/form-data                              â•‘
â•‘  Authorization: Bearer eyJhbGc...                               â•‘
â•‘                                                                   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â•‘
â•‘  â”‚ Form Data:                          â”‚                        â•‘
â•‘  â”‚                                     â”‚                        â•‘
â•‘  â”‚ file: [Binary Video Data]           â”‚ â† 50MB                â•‘
â•‘  â”‚ fileType: "video"                   â”‚                        â•‘
â•‘  â”‚ title: "My Video"                   â”‚                        â•‘
â•‘  â”‚ description: "Test video"           â”‚                        â•‘
â•‘  â”‚ chatId: "507f1f77bcf86cd799439011"  â”‚ (optional)             â•‘
â•‘  â”‚                                     â”‚                        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â†“
                    [SERVER PROCESSING]
                       - Validate
                       - Save file
                       - Create DB records
                              â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   RESPONSE (Server â†’ Client)                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘  HTTP/1.1 201 Created                                           â•‘
â•‘  Content-Type: application/json                                 â•‘
â•‘                                                                   â•‘
â•‘  {                                                              â•‘
â•‘    "success": true,                                             â•‘
â•‘    "message": "Media uploaded successfully",                    â•‘
â•‘    "uploadId": "1707824456123-987654321",                       â•‘
â•‘    "fileUrl": "http://server/uploads/media/video.mp4",          â•‘
â•‘    "fileName": "video.mp4",                                     â•‘
â•‘    "fileType": "video",                                         â•‘
â•‘    "fileSize": 52428800                                         â•‘
â•‘  }                                                              â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Incoming Request               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Validate Token  â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚      â”‚
          âœ“  â”‚      â”‚ âœ— (No/Invalid token)
             â†“      â†“
          Process  401 Unauthorized
             â”‚      â”‚
             â”‚      â””â”€â”€â†’ Return Error
             â”‚
             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Validate File   â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚      â”‚
          âœ“  â”‚      â”‚ âœ— (Invalid type/size)
             â†“      â†“
          Process  400 Bad Request
             â”‚      â”‚
             â”‚      â””â”€â”€â†’ Cleanup & Return Error
             â”‚
             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Save to Disk     â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚      â”‚
          âœ“  â”‚      â”‚ âœ— (I/O error)
             â†“      â†“
          Process  500 Server Error
             â”‚      â”‚
             â”‚      â””â”€â”€â†’ Cleanup & Return Error
             â”‚
             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Create DB Record â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚      â”‚
          âœ“  â”‚      â”‚ âœ— (DB error)
             â†“      â†“
          Return   500 Server Error
          Success   â”‚
             â”‚      â””â”€â”€â†’ Delete file & Return Error
             â”‚
             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 201 Created      â”‚
        â”‚ + uploadId       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Metrics

```
Operation              Speed Estimate    Memory Usage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File Upload (500MB)    5-20 MB/s        ~50 MB
Progress Check         < 100ms          ~5 MB
Cancel Upload          < 500ms          ~10 MB
DB Write              < 50ms           ~5 MB

Limits:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Max File Size:    500 MB
Max Concurrent:   Limited by server RAM
DB Indexes:       5 optimized indexes
Retention:        Based on disk space
```

---

## Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Your Flutter App                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚  ApiService.uploadMediaContent()              â”‚
â”‚    â”‚                                          â”‚
â”‚    â”œâ”€â†’ File.pick()                           â”‚
â”‚    â”œâ”€â†’ POST /api/upload/media                â”‚
â”‚    â”œâ”€â†’ GET /api/upload/progress (polling)    â”‚
â”‚    â””â”€â†’ UI Progress Update                    â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â† JWT Token from LoginScreen
              â† Auth Provider
              â† SharedPreferences
              â”‚
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Backend Server     â”‚
        â”‚                      â”‚
        â”‚  3 New Endpoints:    â”‚
        â”‚  âœ“ POST /upload      â”‚
        â”‚  âœ“ GET /progress     â”‚
        â”‚  âœ“ POST /cancel      â”‚
        â”‚                      â”‚
        â”‚  2 New Models:       â”‚
        â”‚  âœ“ MediaUpload       â”‚
        â”‚  âœ“ UploadProgress    â”‚
        â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Checklist

```
Pre-Deployment
â””â”€ [âœ“] Code reviewed
â””â”€ [âœ“] Syntax checked (no errors)
â””â”€ [âœ“] Dependencies installed (multer)
â””â”€ [âœ“] Storage directories ready

Deployment
â””â”€ [âœ“] Push code to server
â””â”€ [âœ“] mkdir -p uploads/media
â””â”€ [âœ“] chmod 755 uploads/media
â””â”€ [âœ“] npm start

Post-Deployment
â””â”€ [âœ“] Test POST /api/upload/media
â””â”€ [âœ“] Test GET /api/upload/progress/:id
â””â”€ [âœ“] Test POST /api/upload/cancel/:id
â””â”€ [âœ“] Check file permissions
â””â”€ [âœ“] Monitor server logs
â””â”€ [âœ“] Test with Flutter app

Monitoring
â””â”€ [âœ“] Check disk space usage
â””â”€ [âœ“] Monitor CPU usage
â””â”€ [âœ“] Review error logs
â””â”€ [âœ“] Track success rates
```

